<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dreamtale Isometric (Prototype)</title>
  <link rel="stylesheet" href="style.css?v=iso2.5" />
</head>
<body>

  <!-- Fallback + banner di stato -->
  <script>
    (function(){
      var b=document.createElement('div');
      b.id='bootBanner';
      b.style.cssText='position:fixed;left:8px;top:8px;background:#0b1224;color:#9ca3af;border:1px solid #1f2a44;border-radius:8px;padding:6px 10px;z-index:10000;font:12px system-ui';
      b.textContent='boot: index.html ok ‚Äî in attesa di game.js‚Ä¶';
      document.addEventListener('DOMContentLoaded', function(){ document.body.appendChild(b); });
      window.__BOOT_BANNER__=b;
    })();

    // Fallback UI handlers (sovrascritti da game.js se parte)
    window.startGame = function(){
      var t=document.getElementById('titleScreen');
      if(t){ t.classList.remove('show'); t.style.display='none'; }
      if(window.__BOOT_BANNER__){ __BOOT_BANNER__.textContent='startGame() fallback eseguito'; }
    };
    window.resetSave = function(){ try{ localStorage.clear(); }catch(e){} location.reload(); };
    window.backToMenu = function(){
      var d=document.getElementById('deathScreen'); if(d)d.classList.remove('show');
      var t=document.getElementById('titleScreen'); if(t){ t.classList.add('show'); t.style.display='grid'; }
    };
    window.toggleMinimap = function(){
      var box=document.getElementById('minimapBox'); if(!box) return;
      box.classList.toggle('collapsed');
    };
    window.hideMinimap = function(){
      var box=document.getElementById('minimapBox'); if(box) box.classList.add('collapsed');
    };
    window.toggleQuest = function(){
      var p=document.getElementById('questPanel'); if(!p) return;
      p.classList.toggle('collapsed');
    };
    window.hideQuest = function(){
      var p=document.getElementById('questPanel'); if(p) p.classList.add('collapsed');
    };
  </script>

  <!-- Title Screen -->
  <div id="titleScreen" class="overlay show">
    <div class="panel">
      <h1 class="logo">Dreamtale (Isometric)</h1>
      <p class="subtitle">Tap-to-move ‚Ä¢ Isometrico ‚Ä¢ Fireball AoE</p>
      <div class="menu">
        <button class="btn primary" onclick="startGame()">‚ñ∂ Inizia</button>
        <button class="btn danger" onclick="resetSave()">üóë Reset Salvataggio</button>
      </div>
      <div class="options">
        <label><input type="checkbox" id="optPathHighlight"> Evidenzia percorso (debug)</label>
      </div>
    </div>
  </div>

  <!-- HUD in alto -->
  <div id="hudNostale">
    <div class="charbox">
      <div class="portrait"></div>
      <div class="bars">
        <div class="bar hp"><span id="hptext">100/100</span><div id="hpfill"></div></div>
        <div class="bar mp"><span id="mptext">100/100</span><div id="mpfill"></div></div>
        <div class="info">
          <span>LV <strong id="lvl">1</strong></span>
          <span>ü™ô <strong id="coins">0</strong></span>
          <span>üçµ <strong id="pots">0</strong></span>
        </div>
      </div>
    </div>
    <div class="quickbar">
      <button class="slot" title="Mostra/Nascondi minimappa" onclick="toggleMinimap()">üó∫Ô∏è</button>
      <button class="slot" title="Mostra/Nascondi quest" onclick="toggleQuest()">üìú</button>
    </div>
  </div>

  <!-- Sidebar destra -->
  <aside id="sidebar">
    <div id="minimapBox" class="side-panel">
      <div class="side-head">
        <span>Minimappa</span>
        <button class="tiny" title="Nascondi" onclick="hideMinimap()">‚úñ</button>
      </div>
      <canvas id="minimap" width="160" height="160" aria-label="Minimappa"></canvas>
    </div>

    <div id="questPanel" class="side-panel">
      <div class="side-head">
        <span>Quest</span>
        <div>
          <button id="btnQuestReset" class="tiny" title="Reset quest">‚Ü∫</button>
          <button class="tiny" title="Nascondi" onclick="hideQuest()">‚úñ</button>
        </div>
      </div>
      <div class="quest">
        <div class="q-title">Raccogli <strong id="qtarget">30</strong> monete</div>
        <div class="q-progress"><div id="qfill"></div></div>
        <div class="q-meta">Prog: <span id="qcount">0</span>/<span id="qmax">30</span> ‚Ä¢ Ricompensa: +<span id="qreward">30</span> EXP</div>
      </div>
    </div>
  </aside>

  <main>
    <div id="wrap">
      <canvas id="game" width="1024" height="768"></canvas>
      <p class="note">Tocca/clicca per muoverti. Premi <b>1</b> o clicca l'icona per lanciare <b>Fireball</b> AoE.</p>
      <div id="dbg" class="dbg"></div>
    </div>
  </main>

  <!-- EXP bar -->
  <div id="expBar">
    <div id="xpfill"></div>
    <span id="xptext">EXP 0%</span>
  </div>

  <!-- Skill bar -->
  <div id="skillbar">
    <button id="skill1" class="skill" title="Fireball (1)">
      <img src="assets/fireball.png" alt="Fireball" />
      <span class="key">1</span>
      <div class="cd" id="skill1cd"></div>
    </button>
  </div>

  <!-- Death -->
  <div id="deathScreen" class="overlay">
    <div class="panel">
      <h2 class="logo">Sei Morto</h2>
      <p class="subtitle">Hai perso il 10% delle monete. Vuoi respawnare?</p>
      <div class="menu">
        <button id="btnRespawn" class="btn primary">‚Üª Respawn</button>
        <button class="btn" onclick="backToMenu()">‚ò∞ Torna al Menu</button>
      </div>
    </div>
  </div>

  <!-- Carico game.js (cache buster) -->
  <script defer src="game.js?v=iso2.5"></script>
</body>
</html>
